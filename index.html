<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IDRISIUM IDEAS Â· ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£ÙÙƒØ§Ø±</title>
  <link rel="icon" href="data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' fill='%23000'/%3E%3Cpath d='M12 52L32 12l20 40H44l-4-8H24l-4 8z' fill='%2339FF14'/%3E%3C/svg%3E">
  <style>
    :root {
      --bg:#000;
      --surface:rgba(255,255,255,0.05);
      --surface-2:rgba(255,255,255,0.08);
      --border:rgba(255,255,255,0.12);
      --text:#ededed;
      --muted:#a0a0a0;
      --neon:#39FF14;
      --teal:#00d9ff;
      --danger:#ff4d4f;
      --radius:18px;
      --shadow:0 18px 48px rgba(0,0,0,0.55);
      font-family:"Inter","Cairo",system-ui,-apple-system,"Segoe UI",sans-serif;
    }
    * { box-sizing:border-box; }
    body {
      margin:0;
      min-height:100vh;
      background:var(--bg);
      color:var(--text);
      display:block;
      padding:32px 16px 48px;
    }
    .page {
      width:100%;
      max-width:1400px;
      display:flex;
      flex-direction:column;
      gap:18px;
      margin:0 auto;
    }
    .layout {
      display:grid;
      grid-template-columns: minmax(0,1.7fr) minmax(340px,0.9fr);
      gap:18px;
      width:100%;
    }
    .card {
      background:var(--surface);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:20px;
      backdrop-filter:blur(6px);
    }
    h1,h2 { margin:0; font-family:"Orbitron","Inter","Cairo",sans-serif; letter-spacing:0.4px; }
    h1 { font-size:26px; }
    h2 { font-size:20px; }
    p { margin:0; color:var(--muted); }
    .stack { display:flex; flex-direction:column; gap:12px; }
    label { display:block; font-size:14px; margin-bottom:6px; color:var(--muted); }
    input, textarea, select {
      width:100%;
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.14);
      color:var(--text);
      border-radius:14px;
      padding:12px 14px;
      font-size:14px;
      outline:none;
      direction:rtl;
      text-align:right;
      transition:border-color 0.2s ease, box-shadow 0.2s ease;
      appearance:none;
    }
    input:focus, textarea:focus {
      border-color:var(--neon);
      box-shadow:0 0 0 3px rgba(57,255,20,0.16);
    }
    textarea { min-height:130px; resize:vertical; }
    .btn {
      width:100%;
      background:var(--neon);
      color:#000;
      border:none;
      border-radius:12px;
      padding:12px 14px;
      font-weight:700;
      font-size:14px;
      cursor:pointer;
      transition:transform 0.12s ease, filter 0.12s ease;
    }
    .btn:hover { filter:brightness(0.95); }
    .btn:active { transform:scale(0.99); }
    .ideas { display:flex; flex-direction:column; gap:10px; margin-top:12px; }
    .idea {
      border-radius:14px;
      border:1px solid rgba(255,255,255,0.1);
      background:rgba(255,255,255,0.03);
      padding:14px 16px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .idea h3 { margin:0 0 6px; font-size:15px; color:var(--text); }
    .idea p { margin:0; color:var(--muted); line-height:1.5; }
    .empty { color:var(--muted); text-align:center; padding:10px 0; }
    .idea-meta {
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      font-size:12px;
      color:var(--muted);
    }
    .pill {
      padding:6px 10px;
      border-radius:12px;
      border:1px solid var(--border);
      background:rgba(255,255,255,0.05);
      color:var(--text);
      font-size:12px;
    }
    .idea-actions {
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .btn-secondary {
      background:rgba(255,255,255,0.08);
      color:var(--text);
      border:1px solid var(--border);
    }
    .btn-danger {
      background:rgba(255,77,79,0.14);
      color:#ffb3b4;
      border:1px solid rgba(255,77,79,0.4);
    }
    .stats-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
      gap:10px;
      margin-top:12px;
    }
    .stat {
      padding:12px 14px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(255,255,255,0.03);
      display:flex;
      flex-direction:column;
      gap:4px;
      color:var(--text);
    }
    .stat .value { font-size:20px; font-weight:800; }
    .footer {
      margin-top:24px;
      padding:18px;
      background:linear-gradient(135deg,rgba(255,255,255,0.06),rgba(255,255,255,0.02));
      border:1px solid var(--border);
      border-radius:var(--radius);
      text-align:center;
      grid-column:1 / -1;
      color:var(--text);
      box-shadow:var(--shadow);
    }
    .footer .links { display:flex; justify-content:center; gap:14px; flex-wrap:wrap; margin-top:10px; color:var(--muted); }
    .footer a { color:var(--text); text-decoration:none; }
    .avatar {
      width:32px; height:32px; border-radius:50%; display:grid; place-items:center;
      background:linear-gradient(135deg,rgba(57,255,20,0.5),rgba(0,217,255,0.4));
      color:#000; font-weight:800; border:1px solid var(--border);
    }
    .idea-header { display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .idea-owner { display:flex; align-items:center; gap:8px; }
    .badge { padding:4px 8px; border-radius:10px; background:rgba(57,255,20,0.15); color:var(--text); border:1px solid var(--border); font-size:11px;}
    header {
      width:100%;
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:18px 20px;
      border-radius:var(--radius);
      border:1px solid var(--border);
      background:linear-gradient(135deg,rgba(255,255,255,0.06),rgba(255,255,255,0.02));
      box-shadow:var(--shadow);
      gap:12px;
    }
    .side {
      display:flex;
      flex-direction:column;
      gap:18px;
      position:sticky;
      top:16px;
      align-self:start;
      min-width:0;
    }
    .brand { display:flex; align-items:center; gap:12px; }
    .logo {
      width:44px; height:44px; border-radius:12px; display:grid; place-items:center;
      background:linear-gradient(135deg,rgba(57,255,20,0.15),rgba(0,217,255,0.15));
      border:1px solid var(--border); color:var(--text); font-weight:900; font-size:18px;
    }
    .actions { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .chip {
      padding:8px 12px; border-radius:12px; border:1px solid var(--border);
      background:rgba(255,255,255,0.04); color:var(--text); font-size:13px;
    }
    .auth-btn {
      background:var(--neon); color:#000; border:none; border-radius:12px;
      padding:10px 14px; font-weight:800; cursor:pointer; transition:transform 0.12s ease, filter 0.12s ease;
    }
    .ghost-btn {
      background:transparent; color:var(--text); border:1px solid var(--border);
      border-radius:12px; padding:10px 14px; cursor:pointer; transition:transform 0.12s ease, border-color 0.12s ease;
    }
    .auth-btn:hover, .ghost-btn:hover { filter:brightness(0.95); }
    .auth-btn:active, .ghost-btn:active { transform:scale(0.98); }
    .two-col { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:10px; }
    .toolbar {
      display:grid;
      grid-template-columns: repeat(auto-fit,minmax(200px,1fr));
      gap:10px;
      margin-top:12px;
    }
    .toolbar .pill-toggle {
      display:flex; align-items:center; justify-content:center; gap:8px; cursor:pointer;
      padding:10px 12px; border-radius:12px; border:1px solid var(--border);
      background:rgba(255,255,255,0.04); color:var(--text); font-weight:700;
      transition:border-color 0.12s ease, background 0.12s ease;
    }
    .toolbar .pill-toggle.active {
      border-color:var(--neon);
      background:rgba(57,255,20,0.12);
      color:var(--text);
    }
    .toolbar input {
      width:100%; border-radius:12px; border:1px solid var(--border);
      padding:10px 12px; background:rgba(255,255,255,0.05); color:var(--text);
    }
    .toolbar select {
      width:100%; border-radius:12px; border:1px solid var(--border);
      padding:10px 12px; background:rgba(255,255,255,0.05); color:var(--text);
    }
    @media (max-width:640px) {
      body { padding:20px 12px; }
      .card { padding:16px; }
      h1 { font-size:22px; }
      .layout { grid-template-columns:1fr; }
      header { flex-direction:column; align-items:flex-start; }
      .side { position:static; }
    }
  </style>
</head>
<body>
  <main class="page">
    <header>
      <div class="brand">
        <div class="logo">I</div>
        <div>
          <h1 style="font-size:22px;">IDRISIUM IDEAS</h1>
          <p style="margin-top:4px;">"Mafish 2alb.. Fi bas Talaga" â€¢ Offline-first</p>
        </div>
      </div>
      <div class="actions">
        <span id="authStatus" class="chip">ØºÙŠØ± Ù…Ø³Ø¬Ù‘Ù„</span>
        <button id="loginBtn" class="auth-btn">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¨Ø¬ÙˆØ¬Ù„</button>
        <button id="logoutBtn" class="ghost-btn" style="display:none;">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
      </div>
    </header>

    <div class="layout">
      <div class="stack">
        <section class="card">
          <div class="stack">
            <div>
              <h2>Ø§ÙƒØªØ¨ ÙÙƒØ±ØªÙƒ</h2>
              <p>Ø§Ù…Ù„Ø£ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù„ØªØ¸Ù‡Ø± ÙÙƒØ±ØªÙƒ Ø¨Ø´ÙƒÙ„ Ø§Ø­ØªØ±Ø§ÙÙŠ. ÙŠØªØ·Ù„Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„.</p>
            </div>
            <form id="ideaForm" class="stack" novalidate>
              <div class="two-col">
                <div>
                  <label for="ideaTitle">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙƒØ±Ø©</label>
                  <input id="ideaTitle" name="ideaTitle" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø³Ø§Ø¹Ø¯ Ø´Ø®ØµÙŠ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø®ØµÙˆØµÙŠØ©">
                </div>
                <div>
                  <label for="ideaCategory">Ø§Ù„Ù…Ø¬Ø§Ù„</label>
                  <select id="ideaCategory" name="ideaCategory">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ø§Ù„</option>
                    <option value="AI">Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</option>
                    <option value="Fintech">Ø®Ø¯Ù…Ø§Øª Ù…Ø§Ù„ÙŠØ©</option>
                    <option value="Productivity">Ø¥Ù†ØªØ§Ø¬ÙŠØ©</option>
                    <option value="Community">Ù…Ø¬ØªÙ…Ø¹</option>
                    <option value="Gaming">Ø£Ù„Ø¹Ø§Ø¨</option>
                    <option value="Other">Ø£Ø®Ø±Ù‰</option>
                  </select>
                </div>
              </div>
              <div>
                <label for="ideaDescription">ÙˆØµÙ Ø§Ù„ÙÙƒØ±Ø©</label>
                <textarea id="ideaDescription" name="ideaDescription" placeholder="ØµÙ Ø§Ù„ØªØ¬Ø±Ø¨Ø©ØŒ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ØŒ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆØŒ Ø§Ù„Ø£Ø«Ø± ÙˆØ§Ù„ØªÙ…ÙŠØ²."></textarea>
              </div>
              <div class="two-col">
                <div>
                  <label for="ideaImpact">Ù‚ÙˆØ© Ø§Ù„Ø£Ø«Ø±</label>
                  <select id="ideaImpact" name="ideaImpact">
                    <option value="Ù…ØªÙˆØ³Ø·">Ù…ØªÙˆØ³Ø·</option>
                    <option value="Ø¹Ø§Ù„ÙŠ">Ø¹Ø§Ù„ÙŠ</option>
                    <option value="Ù…Ø±ØªÙØ¹ Ø¬Ø¯Ø§Ù‹">Ù…Ø±ØªÙØ¹ Ø¬Ø¯Ø§Ù‹</option>
                  </select>
                </div>
                <div>
                  <label for="ideaEffort">Ø§Ù„Ø¬Ù‡Ø¯ Ø§Ù„ØªÙ‚Ù†ÙŠ</label>
                  <select id="ideaEffort" name="ideaEffort">
                    <option value="Ù…Ù†Ø®ÙØ¶">Ù…Ù†Ø®ÙØ¶</option>
                    <option value="Ù…ØªÙˆØ³Ø·">Ù…ØªÙˆØ³Ø·</option>
                    <option value="Ù…Ø±ØªÙØ¹">Ù…Ø±ØªÙØ¹</option>
                  </select>
                </div>
              </div>
              <div>
                <label for="ideaTags">ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ© (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø©)</label>
                <input id="ideaTags" name="ideaTags" type="text" placeholder="Ù…Ø«Ø§Ù„: offline, privacy, focus">
              </div>
              <div>
                <label for="ideaNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
                <textarea id="ideaNotes" name="ideaNotes" placeholder="Ù…Ù„Ø®Øµ ØªÙ†ÙÙŠØ°ÙŠØŒ Ù…Ø®Ø§Ø·Ø±ØŒ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ù…ÙˆØ§Ø±Ø¯."></textarea>
              </div>
              <div class="two-col">
                <button id="addIdeaBtn" type="submit" class="btn">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙƒØ±Ø©</button>
                <button id="cancelEditBtn" type="button" class="btn btn-secondary" style="display:none;">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
              </div>
              <p id="formStatus" style="color:var(--muted); font-size:13px;"></p>
            </form>
          </div>
        </section>

        <section class="card">
          <div class="idea-header">
            <h2>Ø§Ù„Ø£ÙÙƒØ§Ø±</h2>
            <div class="idea-actions">
              <span class="pill" id="filterInfo">Ø¹Ø±Ø¶: Ø§Ù„ÙƒÙ„</span>
            </div>
          </div>
          <div class="toolbar">
            <input id="searchIdeas" type="search" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙˆØ§Ù„ÙˆØµÙ ÙˆØ§Ù„ÙˆØ³ÙˆÙ…">
            <select id="filterCategory">
              <option value="">ÙƒÙ„ Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª</option>
              <option value="AI">Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</option>
              <option value="Fintech">Ø®Ø¯Ù…Ø§Øª Ù…Ø§Ù„ÙŠØ©</option>
              <option value="Productivity">Ø¥Ù†ØªØ§Ø¬ÙŠØ©</option>
              <option value="Community">Ù…Ø¬ØªÙ…Ø¹</option>
              <option value="Gaming">Ø£Ù„Ø¹Ø§Ø¨</option>
              <option value="Other">Ø£Ø®Ø±Ù‰</option>
            </select>
            <button type="button" id="filterMine" class="pill-toggle">Ø£ÙÙƒØ§Ø±ÙŠ ÙÙ‚Ø·</button>
          </div>
          <div id="ideasList" class="ideas" aria-live="polite"></div>
          <p id="emptyState" class="empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙÙƒØ§Ø± Ø¨Ø¹Ø¯.</p>
        </section>
      </div>

      <div class="stack">
        <div class="card" style="background:var(--surface-2);">
          <h3 style="margin-bottom:8px;">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ø¨Ø§Ø´Ø±Ø©</h3>
          <div class="stats-grid">
            <div class="stat"><span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙÙƒØ§Ø±</span><span id="statTotal" class="value">0</span></div>
            <div class="stat"><span class="label">Ø£ÙÙƒØ§Ø±ÙŠ</span><span id="statMine" class="value">0</span></div>
            <div class="stat"><span class="label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø£Ø«Ø±</span><span id="statImpact" class="value">-</span></div>
            <div class="stat"><span class="label">Ø£ÙƒØ«Ø± Ù…Ø¬Ø§Ù„</span><span id="statTopCat" class="value">-</span></div>
            <div class="stat"><span class="label">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</span><span id="statUpdated" class="value">â€”</span></div>
          </div>
        </div>
        <div class="card" style="background:var(--surface-2);">
          <h3 style="margin-bottom:8px;">ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h3>
          <ul style="padding-inline-start:18px; color:var(--muted); line-height:1.6; margin:0;">
            <li>Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„.</li>
            <li>ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„/Ø­Ø°Ù ÙÙƒØ±ØªÙƒ Ù„Ø§Ø­Ù‚Ø§Ù‹.</li>
            <li>Ø§Ù„Ø£Ø¯Ù…Ù† (Idris) ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„Ø­Ø°Ù Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©.</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="footer">
      <div style="font-weight:800; font-size:18px;">IDRISIUM Corp.</div>
      <div style="margin-top:6px;">"Mafish 2alb.. Fi bas Talaga" â€” Offline-First â€¢ Privacy-Centric â€¢ High-Performance</div>
      <div style="margin-top:10px; font-size:13px;">Founder & Lead Developer: Idris Ghamid (18)</div>
      <div class="links">
        <a href="http://idrisium.linkpc.net/" target="_blank">Website</a>
        <a href="https://github.com/IDRISIUM" target="_blank">GitHub</a>
        <a href="https://tiktok.com/@idris.ghamid" target="_blank">TikTok</a>
        <a href="https://instagram.com/idris.ghamid" target="_blank">Instagram</a>
        <a href="https://t.me/IDRV72" target="_blank">Telegram</a>
        <a href="mailto:idris.ghamid@gmail.com">Email</a>
      </div>
      <div style="margin-top:10px; font-size:12px; color:var(--muted);">Â© IDRISIUM Corp. Built with focus and respect for users' data.</div>
    </div>
  </main>

  <script>
    const STORAGE_KEY = 'idrisium_ideas_v2';
    const USER_KEY = 'idrisium_user_v1';
    const ADMIN_EMAIL = 'idris.ghamid@gmail.com';
    const GOOGLE_CLIENT_ID = ''; // Ø¶Ø¹ Client ID Ù‡Ù†Ø§ Ø¹Ù†Ø¯ ØªÙˆÙØ±Ù‡

    let ideas = [];
    let currentUser = null;
    let editId = null;
    const filters = { query:'', category:'', mine:false };

    const listEl = document.getElementById('ideasList');
    const emptyState = document.getElementById('emptyState');
    const titleInput = document.getElementById('ideaTitle');
    const descInput = document.getElementById('ideaDescription');
    const statTotal = document.getElementById('statTotal');
    const statMine = document.getElementById('statMine');
    const statImpact = document.getElementById('statImpact');
    const statTopCat = document.getElementById('statTopCat');
    const statUpdated = document.getElementById('statUpdated');
    const searchInput = document.getElementById('searchIdeas');
    const filterCategory = document.getElementById('filterCategory');
    const filterMineBtn = document.getElementById('filterMine');

    function saveIdeas() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(ideas));
    }
    function loadIdeas() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        ideas = raw ? JSON.parse(raw) : [];
      } catch { ideas = []; }
    }
    function saveUser(user) {
      localStorage.setItem(USER_KEY, JSON.stringify(user));
    }
    function loadUser() {
      try {
        const raw = localStorage.getItem(USER_KEY);
        currentUser = raw ? JSON.parse(raw) : null;
      } catch { currentUser = null; }
    }

    function fmtDate(ts) {
      const d = new Date(ts);
      return d.toLocaleString('ar-EG', { hour12:false });
    }

    function avatarFor(name) {
      return name ? name.trim()[0]?.toUpperCase() || '?' : '?';
    }

    function updateAuthUI() {
      if (currentUser) {
        authStatus.textContent = `${currentUser.name} (${currentUser.email})`;
        loginBtn.style.display = 'none';
        logoutBtn.style.display = 'inline-block';
        filterMineBtn.disabled = false;
      } else {
        authStatus.textContent = 'ØºÙŠØ± Ù…Ø³Ø¬Ù‘Ù„';
        loginBtn.style.display = 'inline-block';
        logoutBtn.style.display = 'none';
        filters.mine = false;
        filterMineBtn.classList.remove('active');
        filterMineBtn.disabled = true;
      }
    }

    function updateStats() {
      statTotal.textContent = ideas.length;
      const mine = ideas.filter(i => currentUser && i.owner.email === currentUser.email).length;
      statMine.textContent = mine;

      if (ideas.length === 0) {
        statImpact.textContent = '-';
        statTopCat.textContent = '-';
        statUpdated.textContent = 'â€”';
        return;
      }
      const impactScore = { 'Ù…ØªÙˆØ³Ø·':1, 'Ø¹Ø§Ù„ÙŠ':2, 'Ù…Ø±ØªÙØ¹ Ø¬Ø¯Ø§Ù‹':3 };
      const avg = ideas.reduce((s,i)=>s+(impactScore[i.impact]||1),0)/ideas.length;
      const label = avg>=2.5?'ğŸ”¥ Ù‚ÙˆÙŠ':avg>=1.5?'âœ¨ Ø¬ÙŠØ¯':'Ù…ØªÙˆØ³Ø·';
      statImpact.textContent = label;
      const catCount = ideas.reduce((map,i)=>{
        map[i.category||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯']=(map[i.category||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯']||0)+1; return map;
      },{});
      const topCat = Object.entries(catCount).sort((a,b)=>b[1]-a[1])[0];
      statTopCat.textContent = topCat ? `${topCat[0]} (${topCat[1]})` : '-';
      const lastUpdated = ideas.reduce((max,i)=>Math.max(max,new Date(i.updatedAt||i.createdAt).getTime()),0);
      statUpdated.textContent = fmtDate(lastUpdated);
    }

    function describeFilters() {
      const parts = [];
      if (filters.category) parts.push(`Ù…Ø¬Ø§Ù„: ${filters.category}`);
      if (filters.mine) parts.push('Ø£ÙÙƒØ§Ø±ÙŠ ÙÙ‚Ø·');
      if (filters.query) parts.push('Ø¨Ø­Ø« Ù†Ø´Ø·');
      return parts.length ? parts.join(' â€¢ ') : 'Ø¹Ø±Ø¶: Ø§Ù„ÙƒÙ„';
    }

    function filteredIdeas() {
      const q = filters.query;
      const cat = filters.category;
      return [...ideas]
        .sort((a,b)=> new Date(b.updatedAt) - new Date(a.updatedAt))
        .filter(i => {
          if (filters.mine && (!currentUser || i.owner.email !== currentUser.email)) return false;
          if (cat && i.category !== cat) return false;
          if (!q) return true;
          const hay = `${i.title} ${i.description} ${i.tags.join(' ')}`.toLowerCase();
          return hay.includes(q);
        });
    }

    function updateEmptyState(visibleCount) {
      const hasItems = visibleCount > 0;
      if (emptyState) {
        emptyState.style.display = hasItems ? 'none' : 'block';
        emptyState.textContent = filters.query || filters.category || filters.mine
          ? 'Ù„Ø§ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«/Ø§Ù„ØªØµÙÙŠØ©.'
          : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙÙƒØ§Ø± Ø¨Ø¹Ø¯.';
      }
      document.getElementById('filterInfo').textContent = describeFilters();
    }

    function resetForm() {
      form.reset();
      editId = null;
      cancelEditBtn.style.display = 'none';
      formStatus.textContent = '';
      document.getElementById('addIdeaBtn').textContent = 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙƒØ±Ø©';
    }

    function renderIdeas() {
      listEl.innerHTML = '';
      const visible = filteredIdeas();
      visible.forEach(idea => {
        const card = document.createElement('article');
        card.className = 'idea';
        const mine = currentUser && idea.owner.email === currentUser.email;
        const isAdmin = currentUser && currentUser.email === ADMIN_EMAIL;
        card.innerHTML = `
          <div class="idea-header">
            <div class="idea-owner">
              <div class="avatar">${avatarFor(idea.owner.name)}</div>
              <div>
                <div style="color:var(--text); font-weight:700;">${idea.title}</div>
                <div style="font-size:12px; color:var(--muted);">${idea.owner.name} â€¢ ${fmtDate(idea.updatedAt)}</div>
              </div>
            </div>
            <div class="badge">${idea.category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
          </div>
          <p>${idea.description}</p>
          <div class="idea-meta">
            <span class="pill">Ø§Ù„Ø£Ø«Ø±: ${idea.impact}</span>
            <span class="pill">Ø§Ù„Ø¬Ù‡Ø¯: ${idea.effort}</span>
            ${idea.tags.length ? `<span class="pill">ÙˆØ³ÙˆÙ…: ${idea.tags.join(', ')}</span>` : ''}
          </div>
          ${idea.notes ? `<p style="color:var(--text); font-size:13px; background:rgba(255,255,255,0.03); padding:10px; border-radius:12px; border:1px solid var(--border);">Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${idea.notes}</p>` : ''}
          <div class="idea-actions">
            ${mine ? `<button class="btn btn-secondary" data-action="edit" data-id="${idea.id}">ØªØ¹Ø¯ÙŠÙ„</button>` : ''}
            ${(mine || isAdmin) ? `<button class="btn btn-danger" data-action="delete" data-id="${idea.id}">Ø­Ø°Ù</button>` : ''}
          </div>
        `;
        listEl.appendChild(card);
      });
      updateEmptyState(visible.length);
      updateStats();
    }

    function requireAuth() {
      if (currentUser) return true;
      formStatus.textContent = 'ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¬ÙˆØ¬Ù„ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©.';
      return false;
    }

    function handleSubmit(e) {
      e.preventDefault();
      if (!requireAuth()) return;
      const title = (titleInput.value||'').trim();
      const desc = (descInput.value||'').trim();
      if (!title || !desc) {
        formStatus.textContent = 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ÙˆØµÙ Ù…Ø·Ù„ÙˆØ¨Ø§Ù†.';
        return;
      }
      const category = categoryInput.value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      const impact = impactInput.value || 'Ù…ØªÙˆØ³Ø·';
      const effort = effortInput.value || 'Ù…ØªÙˆØ³Ø·';
      const tags = (tagsInput.value||'').split(',').map(t=>t.trim()).filter(Boolean);
      const notes = (notesInput.value||'').trim();
      const now = new Date().toISOString();

      if (editId) {
        ideas = ideas.map(i => i.id === editId ? { ...i, title, description: desc, category, impact, effort, tags, notes, updatedAt: now } : i);
        formStatus.textContent = 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙƒØ±Ø©.';
      } else {
        const idea = {
          id: crypto.randomUUID(),
          title,
          description: desc,
          category,
          impact,
          effort,
          tags,
          notes,
          createdAt: now,
          updatedAt: now,
          owner: { ...currentUser }
        };
        ideas.unshift(idea);
        formStatus.textContent = 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙƒØ±Ø©.';
      }
      saveIdeas();
      renderIdeas();
      resetForm();
    }

    function handleActions(e) {
      const btn = e.target.closest('button');
      if (!btn || !btn.dataset.action) return;
      const action = btn.dataset.action;
      const id = btn.dataset.id;
      const idea = ideas.find(i=>i.id===id);
      if (!idea) return;
      const isOwner = currentUser && idea.owner.email === currentUser.email;
      const isAdmin = currentUser && currentUser.email === ADMIN_EMAIL;
      if (!(isOwner || isAdmin)) return;

      if (action === 'edit') {
        editId = id;
        titleInput.value = idea.title;
        descInput.value = idea.description;
        categoryInput.value = idea.category;
        impactInput.value = idea.impact;
        effortInput.value = idea.effort;
        tagsInput.value = idea.tags.join(', ');
        notesInput.value = idea.notes || '';
        cancelEditBtn.style.display = 'block';
        document.getElementById('addIdeaBtn').textContent = 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„';
        formStatus.textContent = 'ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…ÙØ¹Ù„.';
        titleInput.scrollIntoView({ behavior:'smooth', block:'center' });
      }
      if (action === 'delete') {
        ideas = ideas.filter(i=>i.id!==id);
        saveIdeas();
        renderIdeas();
      }
    }

    function signInMock() {
      const name = prompt('Ø§Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ù„Ù„Ø¹Ø±Ø¶:') || 'Guest';
      const email = prompt('Ø§Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ (Ù„Ù„ØªØ¬Ø±Ø¨Ø©):') || 'guest@example.com';
      currentUser = { name, email, avatar: null };
      saveUser(currentUser);
      updateAuthUI();
      renderIdeas();
    }

    async function signInWithGoogle() {
      if (!GOOGLE_CLIENT_ID) {
        signInMock();
        return;
      }
      // Placeholder: when client ID Ù…ØªÙˆÙØ±ØŒ Ø£Ø¶Ù Google Identity Services.
      signInMock();
    }

    function signOut() {
      currentUser = null;
      localStorage.removeItem(USER_KEY);
      updateAuthUI();
      renderIdeas();
    }

    loginBtn.addEventListener('click', signInWithGoogle);
    logoutBtn.addEventListener('click', signOut);
    cancelEditBtn.addEventListener('click', resetForm);
    form.addEventListener('submit', handleSubmit);
    listEl.addEventListener('click', handleActions);
    searchInput.addEventListener('input', (e)=>{
      filters.query = (e.target.value||'').trim().toLowerCase();
      renderIdeas();
    });
    filterCategory.addEventListener('change',(e)=>{
      filters.category = e.target.value;
      renderIdeas();
    });
    filterMineBtn.addEventListener('click', ()=>{
      if (!currentUser) return;
      filters.mine = !filters.mine;
      filterMineBtn.classList.toggle('active', filters.mine);
      renderIdeas();
    });

    loadUser();
    loadIdeas();
    updateAuthUI();
    renderIdeas();
  </script>
</body>
</html>